#.................................................................................................................
# M106 - required parameters: S{part_cooling_fan speed} / Usage: M106 S128 (0 to 255)
#   Replaces M106 (Turn Part Cooling Fan ON) to set the variable part_cooling_fan_enabled from PART_COOLING_FAN_VAR macro 
#   and then calls the M106 command.
#.................................................................................................................
# Required variable(s) to be set. Add the following to your global variable dictionary block as:
#
# [gcode_macro PART_COOLING_FAN_VAR]
#  variable_part_cooling_fan_enabled
#
#.................................................................................................................
# Required external macro(s) used by this macro.
#
# _general_Debug
# PART_COOLING_FAN_VAR
#
#.................................................................................................................

#.................................................................................................................
#
## URL Resources: https://ellis3dp.com/Print-Tuning-Guide/articles/useful_macros/hotend_fan_monitoring.html#hotend-fan-rpm-monitoring
#      
#.................................................................................................................

[gcode_macro M106]
# Fan On
description: Part Cooling Fan On
rename_existing: M106.1
gcode:
    _general_Debug msg="M106 - entering"
    {% set S = params.S|float %}
    {% if S > 0.0  %}
  	       SET_GCODE_VARIABLE MACRO=PART_COOLING_FAN_VAR VARIABLE=part_cooling_fan_enabled VALUE=1
    {% else %}
           SET_GCODE_VARIABLE MACRO=PART_COOLING_FAN_VAR VARIABLE=part_cooling_fan_enabled VALUE=0
    {% endif %}
	M106.1 {rawparams}
    _general_Debug msg="M106 - exiting"
    
